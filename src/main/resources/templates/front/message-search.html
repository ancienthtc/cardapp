<!DOCTYPE html>
<html lang='cn' xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/front/Content/wodeshuju.css">
    <link rel="stylesheet" href="/front/Content/commons.css">
    <link rel="stylesheet" href="/front/Content/style.css">
    <link rel="stylesheet" href="/front/Content/tixianjilv.css">
    <link href="/front/Content/assets/css/codemirror.css" rel="stylesheet">
    <link rel="stylesheet" href="/front/Content/assets/css/ace.min.css" />
    <script type="text/javascript" src="/front/Scripts/jquery2.2.2.min.js"></script>
    <script type="text/javascript" src="/front/Scripts/jquery.SuperSlide.2.1.js"></script>
    <script type="text/javascript" src="/front/Scripts/index.js"></script>
    <script type="text/javascript" src="/front/Scripts/jquery.page.js"></script>
    <script src="/front/Scripts/wangEditor.min.js"></script>
    <script src="/front/Content/assets/layer/layer.js" type="text/javascript" ></script>

<style>
    .zt{
       display: inline-block;
    }
    .yi{
        float: left;
        width: 50px;
        line-height: 30px;
        border: 1px solid red;
        color: red;
        display: block;
        margin: 0 5px;
        border-radius:5px;
    }
    .wei{
        float: left;
        width: 50px;
        line-height: 30px;
        border: 1px solid blue;
        color: blue;
        display: block;
        margin: 0 5px;
        border-radius:5px;
    }
</style>
</head>
<body>
<div th:include="front/header"></div>
<div class="banner1"></div>
<div class="xtxx">
    <div class="xtxx_top">
        <div class="xtxx_tit"><p><a th:href="@{/user/personal.php}">个人中心</a>&nbsp;>&nbsp;<a th:href="@{/user/dataCenter.php}">我的数据</a></p></div>
    </div>




    <div class="wdda wdda_profit">



        <div class="wdda_left fl" style="width: 185px">
            <ul class="shuji-nav">
                <li >采购商表</a></li>
                <li>买家内部通讯录</a></li>
                <li>报告下载</a></li>
                <li>制定数据</a></li>
                <li  class="navdowna"><a href="/user/myMessage.php" >留言查询</a></li>
            </ul>
        </div>
        <div class="profit_right mt60 mb238" style="width: 945px;">
            <div class="zxlynr">
                <span class="kddy">姓名</span><input id="name" name="name" type="text" class="wby1"/>
                <span class="kddy">电话</span><input id="tel" name="tel" type="text" class="wby1"/>
                <input name="sub" type="button" class="btn8" id="search" value="搜索"/>
                <br>
            </div>
            <div class="lbgs">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="bgys1">
                    <thead>
                    <tr>
                        <td bgcolor="#009ee7">
                            <div align="center" class="STYLE1">姓名</div>
                        </td>
                        <td bgcolor="#009ee7">
                            <div align="center" class="STYLE1">公司名称</div>
                        </td>
                        <td bgcolor="#009ee7">
                            <div align="center" class="STYLE1">联系方式</div>
                        </td>
                        <td bgcolor="#009ee7">
                            <div align="center" class="STYLE1">邮箱</div>
                        </td>
                        <td bgcolor="#009ee7" class="mpgl">
                            <div align="center" class="STYLE1">状态</div>
                        </td>
                        <td bgcolor="#009ee7">
                            <div align="center" class="STYLE1">查看</div>
                        </td>
                    </tr>
                    </thead>
                    <tbody id="tbody">
                        <tr>
                            <td bgcolor="#c2ebff">
                                <div align="center">2017-08-25</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">阿里网络</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">CEO</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">www.alibaba.com</div>
                            </td>

                            <td bgcolor="#c2ebff">
                                <div align="center" class="clearfix zt">
                                    <a class="yi">已回复</a>
                                    <a class="wei">未回复</a>
                                </div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center" class="mpbj  clearfix ">
                                    <a href="#" class="btnbj">查看</a>
                                    <a href="#" class="btnsc">删除</a>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td bgcolor="#c2ebff">
                                <div align="center">2017-08-25</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">阿里网络</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">CEO</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">www.alibaba.com</div>
                            </td>

                            <td bgcolor="#c2ebff">
                                <div align="center" class="clearfix zt">
                                    <a class="yi">已回复</a>
                                    <a class="wei">未回复</a>
                                </div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center" class="mpbj  clearfix ">
                                    <a href="#" class="btnbj">编辑</a>
                                    <a href="#" class="btnsc">删除</a>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td bgcolor="#c2ebff">
                                <div align="center">2017-08-25</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">阿里网络</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">CEO</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">www.alibaba.com</div>
                            </td>

                            <td bgcolor="#c2ebff">
                                <div align="center" class="clearfix zt">
                                    <a class="yi">已回复</a>
                                    <a class="wei">未回复</a>
                                </div>
                            </td>


                            <td bgcolor="#c2ebff">
                                <div align="center" class="mpbj  clearfix ">
                                    <a href="#" class="btnbj">编辑</a>
                                    <a href="#" class="btnsc">删除</a>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td bgcolor="#c2ebff">
                                <div align="center">2017-08-25</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">阿里网络</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">CEO</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">www.alibaba.com</div>
                            </td>

                            <td bgcolor="#c2ebff">
                                <div align="center" class="clearfix zt">
                                    <a class="yi">已回复</a>
                                    <a class="wei">未回复</a>
                                </div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center"   class="mpbj  clearfix ">
                                    <a href="#" class="btnbj">编辑</a>
                                    <a href="#" class="btnsc">删除</a>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td bgcolor="#c2ebff">
                                <div align="center">2017-08-25</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">阿里网络</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">CEO</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center">www.alibaba.com</div>
                            </td>
                            <td bgcolor="#c2ebff">
                                <div align="center" class="clearfix zt">
                                    <a class="yi">已回复</a>
                                    <a class="wei">未回复</a>
                                </div>
                            </td>

                            <td bgcolor="#c2ebff">
                                <div align="center"  class="mpbj  clearfix ">
                                    <a href="#" class="btnbj">编辑</a>
                                    <a href="#" class="btnsc">删除</a>
                                </div>
                            </td>
                        </tr>
                    </tbody>

                </table>
                <input type="hidden" id="pageNo" value="1">
                <input type="hidden" id="pages" value="1">
                <div class="dede_pages">
                    <ul class="pagelist">
                        <li><a href="#">上一页</a></li>
                        <li><a href="#">1</a></li>
                        <li class="thisclass"><a href="#">2</a></li>
                        <li><a href="#">下一页</a>
                        <li>
                    </ul>
                </div>
            </div>

        </div>

    </div>


    <div th:include="front/footer"></div>

</div>
</body>
</html>
<script type="text/javascript">
    //窗口效果
    //点击登录class为 显示
    $(".btnbj").click(function(){
        $("#gray").show();
        $("#popup").show();//查找ID为popup的DIV show()显示#gray
        tc_center();
    });
    //点击关闭按钮
    $("a.guanbi").click(function(){
        $("#gray").hide();
        $("#popup").hide();//查找ID为popup的DIV hide()隐藏
    })

    //    窗口水平居中
    $(window).resize(function(){
        tc_center();
    });

    function tc_center(){
        var _top=($(window).height()-$(".popup").height())/2;
        var _left=($(window).width()-$(".popup").width())/2;

        $(".popup").css({top:_top,left:_left});
    }
</script>

<script type="text/javascript">
    $(document).ready(function(){

        $(".top_nav").mousedown(function(e){
            $(this).css("cursor","move");//改变鼠标指针的形状
            var offset = $(this).offset();//DIV在页面的位置
            var x = e.pageX - offset.left;//获得鼠标指针离DIV元素左边界的距离
            var y = e.pageY - offset.top;//获得鼠标指针离DIV元素上边界的距离
            $(document).bind("mousemove",function(ev){ //绑定鼠标的移动事件，因为光标在DIV元素外面也要有效果，所以要用doucment的事件，而不用DIV元素的事件

                $(".popup").stop();//加上这个之后

                var _x = ev.pageX - x;//获得X轴方向移动的值
                var _y = ev.pageY - y;//获得Y轴方向移动的值

                $(".popup").animate({left:_x+"px",top:_y+"px"},10);
            });

        });

        $(document).mouseup(function() {
            $(".popup").css("cursor","default");
            $(this).unbind("mousemove");
        });
    })
</script>


<script>

    //按钮点击事件
    function modify(){
        $('.text_info').attr("disabled", false);
        $('.text_info').addClass("add");
        $('#Personal').find('.xinxi').addClass("hover");
        $('#Personal').find('.btn-success').css({'display':'block'});
    };
    function save_info(){
        var num=0;
        var str="";
        $(".xinxi input[type$='text']").each(function(n){
            if($(this).val()=="")
            {

                layer.alert(str+=""+$(this).attr("name")+"不能为空！\r\n",{
                    title: '提示框',
                    icon:0,
                });
                num++;
                return false;
            }
        });
        if(num>0){  return false;}
        else{

            layer.alert('修改成功！',{
                title: '提示框',
                icon:1,
            });
            $('#Personal').find('.xinxi').removeClass("hover");
            $('#Personal').find('.text_info').removeClass("add").attr("disabled", true);
            $('#Personal').find('.btn-success').css({'display':'none'});
            layer.close(index);

        }
    };

</script>

<script type="text/javascript">
    //点击
    var clickImg = function(obj){
        $(obj).parent().find('.upload_input').click();
    }
    //删除
    var deleteImg = function(obj){
        $(obj).parent().find('input').val('');
        $(obj).parent().find('img.preview').attr("src","");
        //IE9以下
        $(obj).parent().find('img.preview').css("filter","");
        $(obj).hide();
        $(obj).parent().find('.addImg').show();
    }
    //选择图片
    function change(file) {
        //预览
        var pic = $(file).parent().find(".preview");
        //添加按钮
        var addImg = $(file).parent().find(".addImg");
        //删除按钮
        var deleteImg = $(file).parent().find(".delete");

        var ext=file.value.substring(file.value.lastIndexOf(".")+1).toLowerCase();

        // gif在IE浏览器暂时无法显示
        if(ext!='png'&&ext!='jpg'&&ext!='jpeg'){
            if (ext != '') {
                alert("图片的格式必须为png或者jpg或者jpeg格式！");
            }
            return;
        }
        //判断IE版本
        var isIE = navigator.userAgent.match(/MSIE/)!= null,
            isIE6 = navigator.userAgent.match(/MSIE 6.0/)!= null;
        isIE10 = navigator.userAgent.match(/MSIE 10.0/)!= null;
        if(isIE && !isIE10) {
            file.select();
            var reallocalpath = document.selection.createRange().text;
            // IE6浏览器设置img的src为本地路径可以直接显示图片
            if (isIE6) {
                pic.attr("src",reallocalpath);
            }else{
                // 非IE6版本的IE由于安全问题直接设置img的src无法显示本地图片，但是可以通过滤镜来实现
                pic.css("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src=\"" + reallocalpath + "\")");
                // 设置img的src为base64编码的透明图片 取消显示浏览器默认图片
                pic.attr('src','data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==');
            }
            addImg.hide();
            deleteImg.show();
        }else {
            html5Reader(file,pic,addImg,deleteImg);
        }
    }
    //H5渲染
    function html5Reader(file,pic,addImg,deleteImg){
        var file = file.files[0];
        var reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function(e){
            pic.attr("src",this.result);
        }
        addImg.hide();
        deleteImg.show();
    }
</script>

<script>

    $(function () {

        var name = $("#name").val();
        var tel = $("#tel").val();
        var pageNo = $("#pageNo").val();
        var pageSize = 8;
        var url = "/user/messageSearch";
        var info = {name:name,tel:tel,pageNo:pageNo,pageSize:pageSize};
        send_post(url,info);

        $("#search").click(function () {
            var name = $("#name").val();
            var tel = $("#tel").val();
            var pageNo = $("#pageNo").val();
            var pageSize = 8;
            var url = "/user/messageSearch";
            var info = {name:name,tel:tel,pageNo:pageNo,pageSize:pageSize};
            send_post(url,info);
        });

    })

    function send_post(url, info) {
        $.post(url,info,function (data) {
            var tb = $("#tbody");
            tb.empty();
            var html = '';
            $.each(data.list,function(i,row){
                html += '<tr cid="'+row.id+'">';
                html += '<td bgcolor="#c2ebff"><div align="center">'+row.name+'</div></td>';
                html += '<td bgcolor="#c2ebff"><div align="center">'+row.company+'</div></td>';
                html += '<td bgcolor="#c2ebff"><div align="center">'+row.tel+'</div></td>';
                html += '<td bgcolor="#c2ebff"><div align="center">'+row.email+'</div></td>';
                if( row.reply == null || row.reply == "" )
                {
                    html += '<td bgcolor="#c2ebff"><div align="center" class="clearfix zt"><a class="wei">未回复</a></div></td>';
                    html += '<td bgcolor="#c2ebff"><div align="center" class="mpbj clearfix"><a class="btnbj">等待回复</a></div></td>';
                }
                else
                {
                    html += '<td bgcolor="#c2ebff"><div align="center" class="clearfix zt"><a class="yi">已回复</a></div></td>';
                    html += '<td bgcolor="#c2ebff"><div align="center" class="mpbj clearfix"><a href="#" class="btnbj see">查看</a></div></td>';
                }

                html += '</tr>';
            });
            tb.html(html);

            $("#pageNo").val(data.pageNum);
            $("#pages").val(data.pages);

            var pg = $(".dede_pages");
            pg.empty();
            var html2 = '<ul class="pagelist">';
            html2 += '<li class="pre"><a href="javascript:;">上一页</a></li>';

            for( var i=1;i<=data.pages;i++ )
            {
                if(i==data.pageNum)
                {
                    html2 += '<li class="thisclass pg" ><a href="javascript:;">'+i+'</a></li>';
                }
                else
                {
                    html2 += '<li class="pg" pgs="'+i+'"><a href="javascript:;">'+i+'</a></li>';
                }
            }
            html2 += '<li class="next"><a href="javascript:;">下一页</a> <li>';
            html2 += '</ul>';
            pg.html(html2);
            after();
        },"json");
    }

    function after() {
        $('.btnbj.see').on('click', function(){//查看回复
            var cid = $(this).attr("cid");
            layer.open({
                type: 2,
                title: '名片',
                maxmin: true,
                shadeClose: true, //点击遮罩关闭层
                area : ['640px' , '395px'],
                content: '/ /'
            });
        });


        $(".next").click(function () {
            var pageNo = $("#pageNo").val();
            var pages = $("#pages").val();
            pageNo = parseInt(pageNo) + 1;
            if(pageNo>pages)
            {
                return;
            }
            var name = $("#name").val();
            var tel = $("#tel").val();
            var pageSize = 8;
            var url = "/user/messageSearch";
            var info = {name:name,tel:tel,pageNo:pageNo,pageSize:pageSize};
            send_post(url,info);
        });

        $(".pre").click(function () {
            var pageNo = $("#pageNo").val();
            pageNo = parseInt(pageNo) - 1;
            if(pageNo<=0)
            {
                return;
            }
            var name = $("#name").val();
            var tel = $("#tel").val();
            var pageSize = 8;
            var url = "/user/messageSearch";
            var info = {name:name,tel:tel,pageNo:pageNo,pageSize:pageSize};
            send_post(url,info);
        });

        $(".pg").click(function () {
            var pageNo = $(this).attr("pgs");
            if(pageNo==null || typeof(pageNo) == "undefined")
            {
                return;
            }

            var name = $("#name").val();
            var tel = $("#tel").val();
            var pageSize = 8;
            var url = "/user/messageSearch";
            var info = {name:name,tel:tel,pageNo:pageNo,pageSize:pageSize};
            send_post(url,info);
        });


    }



</script>